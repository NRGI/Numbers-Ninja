---
title: 'Numbers Ninja: Class 1'
author: |
  | Hari Subhash
  | Data Scientist @NRGI
date: "`r Sys.Date()`"
output:
  html_notebook:
    code_folding: hide
    highlight: kate
    smart: yes
    theme: cosmo
  pdf_document: default
  html_document:
    df_print: paged
css: assets/custom.css
---
To-Do Items

1. Add package installations to the pre-requisite
2. Add some reading material

<div class="completed">
##Pre-requisites

There two things we need to do before we start the lesson.

1. [Install R](https://cran.r-project.org/): Any of the links on that page should work
2. [Install Rstudio](https://www.rstudio.com/products/rstudio/download/): Choose the option that is suited for your Operating System (OS).

##Get familiar with your working environment

RStudio is an [integrated development environment](https://en.wikipedia.org/wiki/Integrated_development_environment)(IDE) for the programming language R. An IDE is a software application that makes it easier to write and manage code. It is by far the most popular IDE for R and has several features that are custom made to support data science in R.

There are four different panes on RStudio.

1. The console
2. The scripts
3. The viewer
4. The environment

⚡***Ninja Tasks***⚡

1. Create a Numbers Ninja Folder on your local machine
2. Create an R Notebook "Class 1" and save it in this folder

##A quick markdown detour

####What is a markup language?

>In computer text processing, a markup language is a system for annotating a document in a way that is syntactically distinguishable from the text...the whole idea of a mark up language is to avoid the formatting work for the text, as the tags in the mark up language serve the purpose to format the appropriate text (like a header or beginning of a next para...etc.). Every tag used in a Markup language has a property to format the text we write. - Wikipedia

Some examples of markup languages includes - [TeX](https://en.wikipedia.org/wiki/TeX), [LaTeX](https://en.wikipedia.org/wiki/LaTeX), [HTML](https://en.wikipedia.org/wiki/HTML) etc. TeX markup language that created a [typesetting system](https://en.wikipedia.org/wiki/Typesetting) in computers for high quality books. LaTeX is used extensively in academia to create documents. HTML is the language used to create and organize content on the web. All websites use HTML.

####What is R Markdown?

R Markdown combine markdown with R code. You can think of markdown as a markup language that is human readable version of HTML. Using R Markdown we can insert "code chunks" in between R markdown to generate a variety of different document formats such as HTML reports and notebooks, pdf, Word etc. The main benefit of R Markdown is that it is readable and reproducible. 

For this and future R Lab sessions we will be using an RStudio's Notebook feature which is build using R Markdown. An R Notebook is a markdown document with chunks that can be executed independently and interactively, with output visible immediately beneath the input.

In addition to using markdown to markup text, R Markdown documents also use a [YAML](https://en.wikipedia.org/wiki/YAML) header. This is the section right at the top of the notebook that is separated by the `---`. You don't have to learn much about YAML, however, we need to be familiar enough to perform basic tweaks such as adding a new title, changing authors etc.

Here are a few references to keep handy

1. [R Markdown: The definitive guide](https://bookdown.org/yihui/rmarkdown/)
2. [R Markdown cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)


⚡***Ninja Tasks***⚡

1. Create an H2 level header with title Class 1 Exercises
2. Write the following text: "The list below shows the exercises for this class"
3. Create an unordered list with following list items: "1. Practice Shortcuts" "2. Practice dplyr"
3. Click on the preview button at the top left of the IDE to preview your document.

##Shortcuts

Here are a few keyboard shortcuts you should use all the time

1. `Cmd + Option + I` or `Ctrl + Alt + I`: Insert a chunk in markdown/notebook etc
2. `Option + -` or `Alt + -`: Enter the assignment operator
3. `Cmd + Enter` or `Ctrl + Enter`: Run current line/selection
4. `Cmd + Shift + Enter` `Ctrl + Shift + Enter`: Run the entire script if it is a script file or the current chunk in the case of a notebook.
5. `Cmd + Shift + M` or `Ctrl + Shift + M`: Insert pipe operator

You can find more shortcut keys [here](https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts)

⚡***Ninja Tasks***⚡

1. Use the shortcuts to create a new code chunk => assign the string "Hello World" to `myFirstVar` variable => run the line of code => add a print command using `print(myFirstVar)` => run the entire chunk

##Packages

R packages are additional features that extends the functionality of base R. Packages contain custom functions that are pre-written so that you don't have to worry about re-writing all the code required to create them. In addition to functions, packages can also contain data or point database api (such `wbstats` which points to the World Banks data).

⚡***Ninja Tasks***⚡

1. Install the following package - `tidyverse` and `nycflights13` packages using Rstudio

</div>

##Data Manipulation using dplyr

We will be using the `nycflights13` and the `tidyverse` packages for this section. Here is a resource to keep handy whenever you are using the `tidyverse` for [data wrangling](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)


####Tibbles


```{r}
library(dplyr); library(nycflights13)


```

⚡***Ninja Tasks***⚡

1. Create a tibble (of your choice) with three observations and three variables.
2. Show the class and structure of the tibble you created.
3. Convert the mtcars data set to a tibble.
4. Load the nycflights13 package.

```{r}
library(dplyr)
myFavoriteThings <- tibble(gadgets = c("Pixel", "Kindle", "Vaccum Cleaner"), books = c("Das Kapital", "Harry Potter", "Enid Blyton"), hobbies = c("dancing", "hiking", "reading"), milesRun = c(1, 3, 10))

class(myFavoriteThings)
```

```{r}
str(myFavoriteThings)
```

```{r}
mtcars

mtcarTibble <- as_tibble(mtcars)

str(mtcarTibble)
```



####Pipes



⚡***Ninja Tasks***⚡

1. Calculate the square root of the sum of all even numbers from 0 to 200 and create a sequence that goes from the square root to twice its value.

```{r}
seq(from = 1, to = 100, by = 2) %>% 
        sum() %>% 
        sqrt() %>% 
        seq(from = ., to = .*3, by = 3)

seq(from = sqrt(sum(seq(from = 1, to = 100, by = 2))), to = 3 * sqrt(sum(seq(from = 1, to = 100, by = 2))), by = 3)
```




####Filter

Lets find all the flights that departed in the morning

```{r}
morningFlights <- flights %>% 
        filter(dep_time <= 1200 & month == 1 & day == 1)

max(morningFlights$dep_time, na.rm = T)
```

The most delayed flight from JFK in 2013 

```{r}
flights %>% 
        filter(origin == "EWR") %>% 
        filter(dep_delay == max(dep_delay, na.rm = T))
```

```{r}
max(flights$dep_delay, na.rm = T)
```




⚡***Ninja Tasks***⚡

1. Which flight out of JFK was the most delayed in 2013?


```{r}
library(nycflights13)


flights %>% 
    filter(origin == "JFK") %>% 
    filter(dep_delay == max(dep_delay, na.rm = T))
    

```

2. Answer the previous question without using dplyr or pipes.
```{r}
jfkFlights <- flights[flights$origin == "JFK", ]

maxDelay <- max(jfkFlights$dep_delay, na.rm = T)

jfkFlights[jfkFlights$dep_delay == maxDelay & !is.na(jfkFlights$dep_delay), ]
```

3. What were the 5 longest flights (in air time) from NYC in 2013?

```{r}
flights %>%
    arrange(desc(air_time)) %>% 
    filter(row_number() <= 5)

```

another easier way to do this

```{r}
flights %>% 
    top_n(air_time, n = 5)
```


####Select


```{r}
flights %>% 
    filter(origin %in% c("JFK")) %>% ##origin == "JFK" | origin == "EWR"
    select(origin, contains("dest"),air_time) %>% 
    top_n(air_time, n = 10)
```


⚡***Ninja Tasks***⚡

1. Select all the columns that are relevant for arrival and departure delays using a utility function (refer to cheat sheet)


####Arrange

```{r}
flights %>% 
    arrange(desc(dep_delay))
```

Hypothesis: Flights are more delayed around Christmas. Compare mean(dep_delay) to find the answer.

Find the answer? Is that correct?


⚡***Ninja Tasks***⚡

1. Filter the top 10 most delayed flights in JFK and arrange by dep_delay (highest to lowest)

####Mutate


⚡***Ninja Tasks***⚡

1. Create a new variable called total_delay that is the sum of the arrival delay and departure delay

####Group and Summarise


⚡***Ninja Tasks***⚡

1. Create a summary table with the following characteristics for each of the origin airports.
    + Number of flights
    + Number of unique carriers
    + Average departure delays
    + Average flight times (air time)
    + Average arrival delays

⚡***Ninja Tasks***⚡

##Post-requisites

1. Setup a [GitHub Account](https://github.com)
2. Install [GitHub Desktop](https://desktop.github.com/)
3. Read up about [version control](https://www.atlassian.com/git/tutorials/what-is-version-control)
4. Read up about the [tidy tools manifesto](https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html)
